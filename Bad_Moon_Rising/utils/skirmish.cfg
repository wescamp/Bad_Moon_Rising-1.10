#textdomain wesnoth-Bad_Moon_Rising


# this is not for skirmish, per se, but I think here is a good place for it.

#define BMR_HERO_DEATHS
        [event]
        name=last breath
            [filter]
            id=Lorenzon
            [/filter]
        [message]
        speaker=unit
        message= _ "What a dumb way to die..."
        [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
        [event]
        name=last breath
            [filter]
            id=Belleros
            [/filter]
        [message]
        speaker=unit
        message= _ "Oof..."
        [/message]
            [endlevel]                
                result=defeat
            [/endlevel]
        [/event]
        [event]
        name=last breath
            [filter]
            id=Raenna
            [/filter]
        [message]
        speaker=unit
        message= _ "Ack..."
        [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
        [event]
        name=last breath
            [filter]
            id=Carghanna
            [/filter]
        [message]
        speaker=unit
        message= _ "Ouch..."
        [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
        [event]
        name=last breath
            [filter]
            id=Duval
            [/filter]                  
       [message]
        speaker=unit
        message= _ "Ouch..."
        [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
        [event]
        name=last breath
            [filter]
            id=Grat Gareth
            [/filter]                  
       [message]
        speaker=unit
        message= _ "Ouch..."
        [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
        [event]
        name=last breath
            [filter]
            id=Hrala Gareth
            [/filter]                  
       [message]
        speaker=unit
        message= _ "Ouch..."
        [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
#enddef

# This is very specific, not part of the general skirmish macros.  But it is part of skirmishes

#define BMR_CARUSOE_I

[if]
    [have_location]
	x,y=12,8
	terrain=Ql
    [/have_location]
    [and]
    [variable]
	name=carusoe_sk
	numerical_equals=1
    [/variable]
    [/and]
	[then]
	[set_variable]
	    name=carusoe_sk
	    value=0
	[/set_variable]
                [unit]
                    side=2
                    type=Northern Ranger
                    id=Carusoe
                    name=Carusoe
                    x,y=20,7
                    random_traits=yes
                    facing=sw
                [/unit]
        {MOVE_UNIT id=Carusoe 14 6}
        [message]
                speaker=Carusoe
                message = _ "You've come back!  Why?"
        [/message]
        [message]
                speaker=Raenna
                message = _ "To hunt you down and kill you!"
        [/message]
        [message]
                speaker=Carusoe
                message = _ "..."
        [/message]
        {MOVE_UNIT id=Carusoe 20 15}
	[kill]
	    id=Carusoe
	[/kill]
	[/then]
[/if]


[if]
    [have_location]
	x,y=12,13
	terrain=Cea
    [/have_location]
    [and]
    [variable]
	name=carusoe_sk
	numerical_equals=1
    [/variable]
    [/and]
	[then]
	[set_variable]
	    name=carusoe_sk
	    value=0
	[/set_variable]
                [unit]
                    side=2
                    type=Northern Ranger
                    id=Carusoe
                    name=Carusoe
                    x,y=12,20
                    random_traits=yes
                    facing=ne
                [/unit]
        {MOVE_UNIT id=Carusoe 15 16}
        [message]
                speaker=Carusoe
                message = _ "You've come back!  Why?"
        [/message]
        [message]
                speaker=Raenna
                message = _ "To hunt you down and kill you!"
        [/message]
        [message]
                speaker=Carusoe
                message = _ "..."
        [/message]
        {MOVE_UNIT id=Carusoe 4 20}
	[kill]
	    id=Carusoe
	[/kill]
	[/then]
[/if]

[if]
    [have_location]
	x,y=13,6
	terrain=Coa
    [/have_location]
    [and]
    [variable]
	name=carusoe_sk
	numerical_equals=1
    [/variable]
    [/and]
	[then]
	[set_variable]
	    name=carusoe_sk
	    value=0
	[/set_variable]
                [unit]
                    side=2
                    type=Northern Ranger
                    id=Carusoe
                    name=Carusoe
                    x,y=1,12
                    random_traits=yes
                    facing=se
                [/unit]
        {MOVE_UNIT id=Carusoe 3 16}
        [message]
                speaker=Carusoe
                message = _ "You've come back!  Why?"
        [/message]
        [message]
                speaker=Raenna
                message = _ "To hunt you down and kill you!"
        [/message]
        [message]
                speaker=Carusoe
                message = _ "..."
        [/message]
        {MOVE_UNIT id=Carusoe 1 20}
	[kill]
	    id=Carusoe
	[/kill]
	[/then]
[/if]

#enddef

# These are macros for the random skirmishes, used in the scenarios#/SkirmishCalls#.cfg
################################################################

#define BMR_SCATTER_FOES XMIN XMAX YMIN YMAX TYPE NUM SIDE
# There is a better way to do this, it seems....
    [store_locations]
        terrain=Gg,Gs,Ha,Aa,Gs^Fp,Aa^Fpa,Re
	x={XMIN}-{XMAX}
        y={YMIN}-{YMAX}
	[not]
	    [filter]
	    [/filter]
	[/not]
	[not]
	    [filter_adjacent_location] 
		[filter]
		[/filter]
	    [/filter_adjacent_location] 
	[/not]
    variable=foe_locations
    [/store_locations]
    {VARIABLE units_to_place {NUM}}

    [while]
        [variable]
            name=units_to_place
            greater_than=0
        [/variable]

        [do]
            [set_variable]
                name=random_subscript
                rand=1..$foe_locations.length
            [/set_variable]
            {VARIABLE_OP random_subscript add -1}

            [unit]
                x,y=$foe_locations[$random_subscript].x,$foe_locations[$random_subscript].y
		type={TYPE}
		side={SIDE}
		generate_name=yes
#### experimental### Doesn't work.  How am I supposed to reference a given variable?  vars.myvariable or vars[#]?
# 
#		[ai]
# formula = "if(vars[index] = 1, end, 
#	      if(unit_at( desired_path[0] ),
#                if( desired_path.size > 1,move_partial(me.loc,desired_path[1]),end),
#               move_partial(me.loc,desired_path[0])
#	      )
# where desired_path = shortest_path( me.loc, me.vars.escape )
# where index = index_of(should_run, vars)"
#		[var]
#		escape="loc(1,1)"
#		[/var]
#		formula="if(vars.should_run = 1, move(me.loc, loc(1, 1)), fallback(''))"
#		[/ai]
#        ), 
#	fallback('') )
##################
	    [/unit]

            [store_locations]
                find_in=foe_locations
                [not]
                    x,y=$foe_locations[$random_subscript].x,$foe_locations[$random_subscript].y
                [/not]
                variable=foe_locations
            [/store_locations]

           [if]
                [variable]
                    name=foe_locations.length
                    less_than=1
                [/variable]

                [then]
                    {VARIABLE units_to_place 0}
                [/then]
            [/if]
            {VARIABLE_OP units_to_place add -1}
	[/do]
    [/while]
	{CLEAR_VARIABLE units_to_place}
	{CLEAR_VARIABLE random_subscript}
	{CLEAR_VARIABLE foe_locations}

#enddef

#define BMR_RECALL_STRENGTH
# stores and counts the number of level 2 and 3 units on recall list
# 2010-12-10: no longer recall list.
# a separate macro so it can used with Astreya.
# sets variable 'recallstrength'
	[store_unit]
	    [filter]
		side=1
#		x,y=recall,recall
		[filter_wml]
		    [variables]
			on_call=yes
		    [/variables]
		[/filter_wml]
	    [/filter]
	    variable=recall_list_temp
	    kill=no
	[/store_unit]
	[set_variable]
	    name=index_temp
	    value=0
	[/set_variable]
	[set_variable]
	    name=recallstrength
	    value=0
	[/set_variable]
	[while]
	    [variable]
		name=index_temp
		less_than=$recall_list_temp.length
	    [/variable]
	    [do]
		[set_variable]
		    name=recall_strength_temp
		    value=$recall_list_temp[$index_temp].level
		[/set_variable]
# we add one for level 2 opponent, two for level 3.
		[set_variable]
		    name=recall_strength_temp
		    add=-1
		[/set_variable]
		[if]
		    [variable]
			name=recall_strength_temp
			less_than=0
		    [/variable]
		    [then]
			[set_variable]
			    name=recall_strength_temp
			    value=0
			[/set_variable]
		    [/then]
		[/if]
# we add one for level 2 opponent, two for level 3.
		[set_variable]
		    name=recallstrength
		    add=$recall_strength_temp
		[/set_variable]
		[set_variable]
		    name=index_temp
		    add=1
		[/set_variable]
	    [/do]
	[/while]
# this was ramping too fast, adjust the scenarios harder, not the skirmishes
	[set_variable]
	    name=recallstrength
	    multiply=0.8
	[/set_variable]
	[set_variable]
	    name=recallstrength
	    ipart=$recallstrength
	[/set_variable]
# OK, so we know this is working
#	[set_variable]
#	    name=recallstrength_testing
#	    value=$recallstrength
#	[/set_variable]	
	{CLEAR_VARIABLE recall_list_temp}
	{CLEAR_VARIABLE recall_strength_temp}
	{CLEAR_VARIABLE index_temp}
# so recallstrength is not negative
	[if]
	    [variable]
		name=recallstrength
		less_than=0
	    [/variable]
		[then]
		[set_variable]
		    name=recallstrength
		    value=0
		[/set_variable]
		[/then]
	[/if]
#enddef



#define BMR_SKIRMISH_FOES NUMBER INDEX
# macro to set up the skirmish foes
# has entries for orcs, humans, primeval, khthon (though not useful ATM)
#	should probably add undead at some point
# NUMBER is number of foes
# INDEX is a number used to choose specific unit groups
# 2010-11-29: There is an error in here, I think.  Strange things happen with the BMR_RECALL_STRENGTH macro and the [generator] tag causes a bogus error

	[event]
	name=prestart
	[set_variable]
	name=skindex
	value={INDEX}
	[/set_variable]
	[store_unit]
	    [filter]
		id=Leader
	    [/filter]
	    kill=no
	    variable=leaderkind
	[/store_unit]
 # decisions of what the enemy troops should be
	    [switch]
		variable=leaderkind.race
		[case]
		    value="orc"
 # OK, so it's orcs.  But how tough are they?
		    [switch]
			variable=skindex
			[case]
			value=0
			[set_variable]
			name=foetype1
			value=Orcish Archer
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Goblin Spearman
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Archaic_Orcish Grunt
			[/set_variable]
			[/case]			
			[case]
			value=1
			[set_variable]
			name=foetype1
			value=Orcish Archer
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Goblin Spearman
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Wolf Rider
			[/set_variable]
			[/case]			
			[case]
			value=2
			[set_variable]
			name=foetype1
			value=Orcish Assassin
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Archaic_Orcish Grunt
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Wolf Rider
			[/set_variable]
			[/case]			
			[case]
			value=3
			[set_variable]
			name=foetype1
			value=Orcish Assassin
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Archaic_Orcish Grunt
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Orcish Rider
			[/set_variable]
			[/case]			
			[case]
			value=4
			[set_variable]
			name=foetype1
			value=Orcish Crossbowman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Raider
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Goblin Knight
			[/set_variable]
			[/case]			
			[case]
			value=5
			[set_variable]
			name=foetype1
			value=Orcish Crossbowman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Warrior
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Goblin Knight
			[/set_variable]
			[/case]			
			[case]
			value=6
			[set_variable]
			name=foetype1
			value=Orcish Slayer
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Warrior
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Orcish Cavalry
			[/set_variable]
			[/case]			
			[case]
			value=7
			[set_variable]
			name=foetype1
			value=Goblin Pillager
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Warrior
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Orcish Cavalry
			[/set_variable]
			[/case]			
			[case]
			value=8
			[set_variable]
			name=foetype1
			value=Orcish Slayer
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Warrior
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Goblin Pillager
			[/set_variable]
			[/case]			
			[case]
			value=9
			[set_variable]
			name=foetype1
			value=Orcish Cavalry
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Maurader
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Goblin Pillager
			[/set_variable]
			[/case]			
			[case]
			value=10
			[set_variable]
			name=foetype1
			value=Orcish Crossbowman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Warrior
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Orcish Cavalry
			[/set_variable]
			[/case]			
			[case]
			value=11
			[set_variable]
			name=foetype1
			value=Orcish Crossbowman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Maurader
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Orcish Cavalry
			[/set_variable]
			[/case]			
			[else]
			[set_variable]
			name=foetype1
			value=Orcish Crossbowman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Orcish Maurader
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Orcish Cavalry
			[/set_variable]
			[/else]			
		    [/switch]			
		[/case]
		[case]
		    value="human"
 # OK, so it's humans.  But how tough are they?
		    [switch]
			variable=skindex
			[case]
			value=1
			[set_variable]
			name=foetype1
			value=Woodsman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Footpad
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Ruffian
			[/set_variable]
			[/case]			
			[case]
			value=2
			[set_variable]
			name=foetype1
			value=Spearman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Woodsman
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Footpad
			[/set_variable]
			[/case]			
			[case]
			value=3
			[set_variable]
			name=foetype1
			value=Spearman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Bowman
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Horseman
			[/set_variable]
			[/case]			
			[case]
			value=4
			[set_variable]
			name=foetype1
			value=Cavalryman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Spearman
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Longbowman
			[/set_variable]
			[/case]			
			[case]
			value=5
			[set_variable]
			name=foetype1
			value=Dragoon
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Spearman
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Longbowman
			[/set_variable]
			[/case]			
			[case]
			value=6
			[set_variable]
			name=foetype1
			value=Swordsman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Dragoon
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Longbowman
			[/set_variable]
			[/case]			
			[case]
			value=7
			[set_variable]
			name=foetype1
			value=Pikeman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Knight
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Longbowman
			[/set_variable]
			[/case]			
			[case]
			value=8
			[set_variable]
			name=foetype1
			value=Pikeman
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Knight
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Javelineer
			[/set_variable]
			[/case]			
		    [/switch]			
		[/case]
		[case]
		    value="primeval"
 # OK, so it's primevals.  But how tough are they?
		    [switch]
			variable=skindex
			[case]
			value=0
			[set_variable]
			name=foetype1
			value=Primevalist Follower
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primeval Slow
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primevalist Fighter
			[/set_variable]
			[/case]			
			[case]
			value=1
			[set_variable]
			name=foetype1
			value=Primeval Swiftfoot
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primeval Slow
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primevalist Fighter
			[/set_variable]
			[/case]			
			[case]
			value=2
			[set_variable]
			name=foetype1
			value=Primeval Swiftfoot
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primevalist Fighter
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primevalist Follower
			[/set_variable]
			[/case]			
			[case]
			value=3
			[set_variable]
			name=foetype1
			value=Primevalist Fighter
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primevalist Monk
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primeval Striker
			[/set_variable]
			[/case]			
			[case]
			value=4
			[set_variable]
			name=foetype1
			value=Primevalist Monk
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primeval Driver
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primeval Striker
			[/set_variable]
			[/case]			
			[case]
			value=5
			[set_variable]
			name=foetype1
			value=Primevalist Fanatic
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primeval Driver
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primeval Ironwheel
			[/set_variable]
			[/case]			
			[else]
			[set_variable]
			name=foetype1
			value=Primeval Striker
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Primeval Driver
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Primeval Ironwheel
			[/set_variable]
			[/else]			
		    [/switch]			
		[/case]
		[case]
		    value="khthon"
 # OK, so it's khthon.  But how tough are they?
 # this needs to be fixed, when they have more unit types
 # ... Took a first pass at that
		    [switch]
			variable=skindex
			[case]
			value=0
			[set_variable]
			name=foetype1
			value=Terrapin
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Horse
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Horse
			[/set_variable]
			[/case]			
			[case]
			value=1
			[set_variable]
			name=foetype1
			value=Terrapin
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Horse
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Yak
			[/set_variable]
			[/case]			
			[case]
			value=2
			[set_variable]
			name=foetype1
			value=Ram
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Arctic Wolf
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Yak
			[/set_variable]
			[/case]			
			[case]
			value=3
			[set_variable]
			name=foetype1
			value=Katoblepon
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Arctic Wolf
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Ophis
			[/set_variable]
			[/case]			
			[case]
			value=4
			[set_variable]
			name=foetype1
			value=Katoblepon
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Prokyon
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Ophis
			[/set_variable]
			[/case]			
			[else]
			[set_variable]
			name=foetype1
			value=OphisMagnum
			[/set_variable]
			[set_variable]
			name=foetype2
			value=Pegusa
			[/set_variable]
			[set_variable]
			name=foetype3
			value=Pyradalon
			[/set_variable]
			[/else]			
		    [/switch]			
		[/case]
		[case]
		    value="despair"
 # 		    value="undead"
 # This is for Astreya and the phantoms, though undead also worked?
		    [switch]
			variable=skindex
			[case]
			value=0
			[set_variable]
			name=foetype1
			value="Phantom Cloak"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Unease"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Rider"
			[/set_variable]
			[/case]			
			[case]
			value=1
			[set_variable]
			name=foetype1
			value="Phantom Cloak"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Cloak"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Rider"
			[/set_variable]
			[/case]			
			[case]
			value=2
			[set_variable]
			name=foetype1
			value="Phantom Cloak"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Spearman"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Rider"
			[/set_variable]
			[/case]			
			[case]
			value=3
			[set_variable]
			name=foetype1
			value="Phantom Widow"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Spearman"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Horseman"
			[/set_variable]
			[/case]			
			[case]
			value=4
			[set_variable]
			name=foetype1
			value="Phantom Shadow"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Horseman"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Widow"
			[/set_variable]
			[/case]			
			[case]
			value=5
			[set_variable]
			name=foetype1
			value="Phantom Shadow"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Horseman"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Soldier"
			[/set_variable]
			[/case]			
			[case]
			value=6
			[set_variable]
			name=foetype1
			value="Phantom White"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Horseman"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Soldier"
			[/set_variable]
			[/case]			
			[case]
			value=7
			[set_variable]
			name=foetype1
			value="Phantom Shadow"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom White"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Soldier"
			[/set_variable]
			[/case]			
			[case]
			value=8
			[set_variable]
			name=foetype1
			value="Phantom Shadow"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Horseman"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Midnight"
			[/set_variable]
			[/case]			
			[else]
			[set_variable]
			name=foetype1
			value="Phantom Midnight"
			[/set_variable]
			[set_variable]
			name=foetype2
			value="Phantom Dullohan"
			[/set_variable]
			[set_variable]
			name=foetype3
			value="Phantom Soldier"
			[/set_variable]
			[/else]			
		    [/switch]			
		[/case]
	    [/switch]
	[set_variable]
	name=foes1
	rand=2..{NUMBER}
	[/set_variable]	
	[set_variable]
	name=foes2
	rand=1..{NUMBER}
	[/set_variable]	
	[set_variable]
	name=foes3
	rand=1..{NUMBER}
	[/set_variable]	
# 2010-12-02: I wonder if there are simply too many locations being stored?  The variable 'random_placement_locations' is not cleared.
# No, the macro just breaks the game if it fails to filter on any locations.
#	{SCATTER_IMAGE (terrain=Aa) $foes1 scenery/pine1.png}
# 2010-12-29:  I'm just going to comment this out.  These things caused more problem than they are worth...
#	{SCATTER_IMAGE (
#	terrain=Aa
#	[filter_adjacent_location]
#		count=2-6
#		terrain=Aa
#	[/filter_adjacent_location]
#			) $foes1 scenery/pine1.png}
# 2010-09-19: this had been filtering on Gg, causing the filter to fail.  Was that causing the bugs?
#	{SCATTER_IMAGE (
#	terrain=Re,Rb
#	[filter_adjacent_location]
#		count=3-6
#		terrain=Re,Rb
#	[/filter_adjacent_location]
#			) $foes2 scenery/rock2.png}
# these ranges are hardcoded, you may want to change that...
	{BMR_SCATTER_FOES 1 20 1 17 $foetype1 $foes1 2}
	{BMR_SCATTER_FOES 1 20 1 17 $foetype2 $foes2 2}
	{BMR_SCATTER_FOES 1 20 1 17 $foetype3 $foes3 2}

# buff up the enemy as the player's recall list is stronger
# 2010-12-10: make the strength depend upon the on-call units only
	{BMR_RECALL_STRENGTH}
# 2010-11-29: commenting ^that^ out does not cause the [generator] error to go away.
# I've removed the generator, so no more [generator] error
	[store_unit]
	    [filter]
		side=2
		canrecruit=no
	    [/filter]
	    kill=yes
	    variable=tobuff
	[/store_unit]
	[set_variable]
	    name=index_temp
	    value=0
	[/set_variable]
	    [while]
		[variable]
		    name=index_temp
		    less_than=$tobuff.length
		[/variable]
		[do]
# this is pure nonsense needed to get around the destruction of recallstrength
# at least it works now...
# 2010-11-29 v1.1.9 (BfW 1.9.2) - It may have worked at once point, but now it doesn't.  Enemies get random negative experience...
# I wonder if this has something to do with the error about [generator] not being supported at the top level ...
# I think I've fixed this...
		    [set_variable]
			name=rs_temp
			value=$recallstrength
		    [/set_variable]
		
		    [if]
			[variable]
			    name=recallstrength
			    less_than=1
			[/variable]
## just unstore the enemy unit
			[then]
		    [unstore_unit]
			variable=tobuff[$index_temp]
			find_vacant=no
		    [/unstore_unit]
			[/then]
			[else]
			    [set_variable]
				name=recallstrength_exp
				value=$recallstrength
			    [/set_variable]
			    [set_variable]
				name=recallstrength_exp
				multiply=10
			    [/set_variable]
			    [set_variable]
				name=tobuff[$index_temp].experience
				value=$recallstrength_exp
			    [/set_variable]
			    [unstore_unit]
				variable=tobuff[$index_temp]
				find_vacant=no
				advance=true
			    [/unstore_unit]
			[/else]
		    [/if]
# restoring recallstrength...
		    [set_variable]
			name=recallstrength
			value=$rs_temp
		    [/set_variable]
	    	    [set_variable]
			name=recallstrength
			add=-2
	    	    [/set_variable]
		    [set_variable]
			name=index_temp
			add=1
		    [/set_variable]
		[/do]
	    [/while]

#			    {CLEAR_VARIABLE recallstrength_exp}	
		
	{CLEAR_VARIABLE foes1}
	{CLEAR_VARIABLE foes2}
	{CLEAR_VARIABLE foes3}
	{CLEAR_VARIABLE foetype1}
	{CLEAR_VARIABLE foetype2}
	{CLEAR_VARIABLE foetype3}
	{CLEAR_VARIABLE skindex}
	{CLEAR_VARIABLE leaderkind}
#	{CLEAR_VARIABLE recallstrength}
	{CLEAR_VARIABLE index_temp}
	{CLEAR_VARIABLE rs_temp}
	{CLEAR_VARIABLE tobuff}
	[/event]


#enddef
# ^ this is the closing of BMR_SKIRMISH_FOES

#define BMR_SK_GRADING
# this will use BMR_SKIRMISH_FOES to make the enemies harder as the player's purse is bigger.  
# $timesfought should also be defined, a variable incremented every time the player has a skirmish
# $timesfought should be defined in one of the off-road macros in the worldmap.cfg
# before we can use this, there needs to be a variable for the recall list... defined above, 
# and included in BMR_SKIRMISH_FOES.  Keep it out of the skirmish generating macro so that it does not
# get included in Astreya's scenarios.

	[event]
	name=prestart
	[store_side]
	side=1
	variable=sideone
	[/store_side]
	[set_variable]
	    name=goldtest
	    value=200
	[/set_variable]
	[set_variable]
	    name=sknumber
	    value=$timesfought
	[/set_variable]
# so that this does not get too out of hand, random may be better
#ifdef HARD
	[set_variable]
	    name=sknumber
	    modulo=5
	[/set_variable]
#endif
#ifdef NORMAL
	[set_variable]
	    name=sknumber
	    modulo=4
	[/set_variable]
#endif
#ifdef EASY
	[set_variable]
	    name=sknumber
	    modulo=2
	[/set_variable]
#endif
# worldmap has timesfought variable, there is a problem here with integer/float, LE-GE-EQ.
#	[set_variable]
#	    name=sknumber
#	    add=-1
#	[/set_variable]
# no, setting skindex0 to sknumber is the problem.  skindex0 should increase with recallstrength?

# now that variables are floating-point, this ruins things...
# When I figure out how to fix this, I will change initial value of goldtest
 # (1.1.0 - What?)
#	[set_variable]
#	    name=sknumber
#	    multiply=0.5
#	[/set_variable]
# this should increase with recallstrength, not sknumber...  I think.
# no, recallstrength affects whether the enemy gets advancements, this is for the skirmish index
# divide by two, make it an integer
	[set_variable]
	    name=skindex0
	    value=$sknumber
	[/set_variable]
# is this even necessary?  It was before 'timesfought' got modulo'd, maybe no longer
#	[set_variable]
#	    name=skindex0
#	    multiply=0.5
#	[/set_variable]
#	[set_variable]
#	    name=skindex0
#	    ipart=$skindex0
#	[/set_variable]
	[if]
	    [variable]
		name=sknumber
		less_than=1
	    [/variable]
	    [then]
	    [set_variable]
		name=sknumber
		value=1
	    [/set_variable]
	    [/then]
	[/if]
	[set_variable]
	    name=sknumber
	    multiply=2
	[/set_variable]
# this makes the enemies stronger if the player has more gold
	[while]
	    [variable]
		name=goldtest
		less_than=$sideone.gold
	    [/variable]
	    [do]
	    [set_variable]
		name=skindex0
		add=1
	    [/set_variable]
	    [set_variable]
		name=goldtest
		add=300
	    [/set_variable]
	    [/do]
	[/while]
	{CLEAR_VARIABLE goldtest}
	{CLEAR_VARIABLE sideone}
# initialized here, used during recalls
# I think this can go ...
	[set_variable]
	name=sk_recallcost
	value=0
	[/set_variable]
	[/event]

# ER OR_FLAG: this is also called in the SkirmishCalls_II/III.cfg
# One or the other needs to go...  Oh, wait.  It was commented out.  Never mind.
	{BMR_SKIRMISH_FOES $sknumber $skindex0} 

#enddef

#define BMR_SK_VICTORY
# So that the skirmishes can serve a purpose, aside from experience
# And restoring the purse


# I'm changing this...
# the victory gold prize, for when the player wins
#	[event]
#	name=start
#	[set_variable]
#	name=sk_prize
#	rand=25,62,71,83,106,121,132,154,167,191,214,221,232,250,264,276,288,300,302,312,320,334,355,363,376,388
#	[/set_variable]
#	[/event]
	[event]
	name=prestart
	    [set_variable]
		name=sk_prize
		value=0
	    [/set_variable]
	[/event]

	[event]
	name=die
	first_time_only=no
	    [filter]
		side=2
	    [/filter]
	    [filter_second]
		side=1
	    [/filter_second]
		[set_variable]
			name=sk_prize_TEMP
			value=$unit.level
		[/set_variable]
	    [switch]
		variable=unit.race
		[case]
		    value=orc
		    [set_variable]
			name=sk_prize_TEMP
			multiply=18
		    [/set_variable]
		    [set_variable]
			name=sk_prize
			add=$sk_prize_TEMP
		    [/set_variable]
		    {CLEAR_VARIABLE sk_prize_TEMP}
		[/case]
		[case]
		    value=human
		    [set_variable]
			name=sk_prize_TEMP
			multiply=19
		    [/set_variable]
		    [set_variable]
			name=sk_prize
			add=$sk_prize_TEMP
		    [/set_variable]
		    {CLEAR_VARIABLE sk_prize_TEMP}
		[/case]
		[case]
		    value=despair
		    [set_variable]
			name=sk_prize_TEMP
			multiply=20
		    [/set_variable]
		    [set_variable]
			name=sk_prize
			add=$sk_prize_TEMP
		    [/set_variable]
		    {CLEAR_VARIABLE sk_prize_TEMP}
		[/case]
		[case]
		    value=primeval
		    [set_variable]
			name=sk_prize_TEMP
			multiply=21
		    [/set_variable]
		    [set_variable]
			name=sk_prize
			add=$sk_prize_TEMP
		    [/set_variable]
		    {CLEAR_VARIABLE sk_prize_TEMP}
		[/case]
		[case]
		    value=orc
		    [set_variable]
			name=sk_prize_TEMP
			multiply=18
		    [/set_variable]
		    [set_variable]
			name=sk_prize
			add=$sk_prize_TEMP
		    [/set_variable]
		    {CLEAR_VARIABLE sk_prize_TEMP}
		[/case]
		[else]
		    [set_variable]
			name=sk_prize_TEMP
			multiply=17
		    [/set_variable]
		    [set_variable]
			name=sk_prize
			add=$sk_prize_TEMP
		    [/set_variable]
		    {CLEAR_VARIABLE sk_prize_TEMP}
		[/else]
	    [/switch]
	[/event]

        [event]
        name=die
        first_time_only=no
            [filter]
                side=2
            [/filter]
            [if]
                [have_unit]
                    side=2
                [/have_unit]
		[else]
		[message]
		side=1
		message= _ "They had some resources, we are $sk_prize|g richer. And we gained some valuable combat experience."
		[/message]
# I don't think this is necessary anymore
#		[allow_recruit]
#		side=1
#		type=Ukian Runner, Ukian Archer, Ukian Regular, Ukian Dog
#		[/allow_recruit]
    [store_unit]
        [filter]
            side=1
		[not]
		    x,y=recall,recall
		[/not]
        [/filter]
        variable=MODIFY_UNIT_store
        kill=yes
    [/store_unit]
    [set_variable]
	name=sk_prize_exp
	value=0.12
    [/set_variable]
    [set_variable]
	name=sk_prize_exp
	multiply=$sk_prize
    [/set_variable]
# float ruins things
    [set_variable]
	name=sk_prize_exp
	ipart=$sk_prize_exp
    [/set_variable]

    {FOREACH MODIFY_UNIT_store MODIFY_UNIT_i}
        [set_variable]
            name=MODIFY_UNIT_store[$MODIFY_UNIT_i].experience
            add=$sk_prize_exp
        [/set_variable]
        [unstore_unit]
            variable=MODIFY_UNIT_store[$MODIFY_UNIT_i]
            find_vacant=no
        [/unstore_unit]
    {NEXT MODIFY_UNIT_i}

    {CLEAR_VARIABLE MODIFY_UNIT_store}
	[message]
	    speaker=narrator
	    message = _ "$sk_prize_exp| experience gained."
	    image = wesnoth-icon.png
	[/message]
    {CLEAR_VARIABLE sk_prize_exp}


		    [gold]
			side=1
			amount=$sk_prize
		    [/gold]
                    [endlevel]
			{CONTINUE}
                    [/endlevel]
                [/else]
            [/if]
        [/event]

# in case the die event above did not fire
        [event]
        name=new turn
        first_time_only=no
            [if]
                [have_unit]
                    side=2
                [/have_unit]
		[else]
		[message]
		side=1
		message= _ "They had some resources, we are $sk_prize|g richer. We also gained some combat experience."
		[/message]
    [store_unit]
        [filter]
            side=1
		[not]
		    x,y=recall,recall
		[/not]
        [/filter]
        variable=MODIFY_UNIT_store
        kill=yes
    [/store_unit]
    [set_variable]
	name=sk_prize_exp
	value=0.12
    [/set_variable]
    [set_variable]
	name=sk_prize_exp
	multiply=$sk_prize
    [/set_variable]
# float ruins things
    [set_variable]
	name=sk_prize_exp
	ipart=$sk_prize_exp
    [/set_variable]

    {FOREACH MODIFY_UNIT_store MODIFY_UNIT_i}
        [set_variable]
            name=MODIFY_UNIT_store[$MODIFY_UNIT_i].experience
            add=$sk_prize_exp
        [/set_variable]
        [unstore_unit]
            variable=MODIFY_UNIT_store[$MODIFY_UNIT_i]
            find_vacant=no
        [/unstore_unit]
    {NEXT MODIFY_UNIT_i}

    {CLEAR_VARIABLE MODIFY_UNIT_store}
	[message]
	    speaker=narrator
	    message = _ "$sk_prize_exp| experience gained."
	    image = wesnoth-icon.png
	[/message]
    {CLEAR_VARIABLE sk_prize_exp}
		[allow_recruit]
		side=1
		type=Ukian Runner, Ukian Archer, Ukian Regular, Ukian Dog
		[/allow_recruit]
		    [gold]
			side=1
			amount=$sk_prize
		    [/gold]
                    [endlevel]
			{CONTINUE}
                    [/endlevel]
                [/else]
            [/if]
        [/event]

#enddef

#define BMR_ENEMY_FLEE FACTOR
# if FAI is working, this will tell the enemy it is time to flee
# it will be used in the skirmish creating scenarios, so that it doesn't get
# placed in Astreya's scenarios
	[event]
	name=new turn
	first_time_only=no
	   [store_unit]
		[filter]
		side=1
		    [not]
			x,y=recall,recall
		    [/not]
		[/filter]
		variable=units_side1
		kill=no
	   [/store_unit]
	   [store_unit]
		[filter]
		side=2
		[/filter]
		variable=units_side2
		kill=no
	   [/store_unit]
	[set_variable]
	name=index_side1
	value=0
	[/set_variable]
	[set_variable]
	name=strength_side1
	value=0
	[/set_variable]
	[while]
	    [variable]
		name=index_side1
		less_than=$units_side1.length
	    [/variable]
	    [do]
		[set_variable]
		name=strength_side1
		add=$units_side1[$index_side1].level
		[/set_variable]
		[set_variable]
		name=index_side1
		add=1
		[/set_variable]
	    [/do]
	[/while]	
	[set_variable]
	name=index_side2
	value=0
	[/set_variable]
	[set_variable]
	name=strength_side2
	value=0
	[/set_variable]
	[while]
	    [variable]
		name=index_side2
		less_than=$units_side2.length
	    [/variable]
	    [do]
		[set_variable]
		name=strength_side2
		add=$units_side2[$index_side2].level
		[/set_variable]
		[set_variable]
		name=index_side2
		add=1
		[/set_variable]
	    [/do]
	[/while]	
	[set_variable]
	name=strength_side1
# this could be adjusted for difficulty...
	multiply={FACTOR}
	[/set_variable]
	[if]
	    [variable]
		name=strength_side2
		less_than=$strength_side1
	    [/variable]
	    [then]
		[set_variable]
		name=should_run
		value=1
		[/set_variable]
	    [/then]
	[/if]
	{CLEAR_VARIABLE units_side1}
	{CLEAR_VARIABLE strength_side1}
	{CLEAR_VARIABLE units_side2}
	{CLEAR_VARIABLE strength_side2}
	{CLEAR_VARIABLE index_side1}
	{CLEAR_VARIABLE index_side2}
	[/event]

	[event]
	name=moveto
	first_time_only=no
	    [filter]
		side=2
		x=1
#		x=1-2
	    [/filter]
	    [kill]
		x,y=$x1,$y1
	    [/kill]
	[fire_event]
	    name=bmr_sk_victory
	[/fire_event]
	[/event]


# FAI related stuff

[event]
    name=ai turn
    first_time_only=no
    [if]
	[variable]
	name=side_number
	numerical_equals=2
	[/variable]
	[then]
	    [if]
	    [variable]
		name=should_run
		numerical_equals=1
	    [/variable]
		[then]
	    	[fire_event]
			name=ai_retreat_start
	    	[/fire_event]
		[/then]
		[else]
	    	[fire_event]
			name=ai_retreat_stop
	    	[/fire_event]
		[/else]
	    [/if]
	[/then]
    [/if]
[/event]

[event]
# taken from Crab's post on the Coder's Corner forum, with some very small changes
    name=ai_retreat_start
    # 'main_loop' is the id of the stage from data/ai/ais/testing_ai_default.cfg
    {MODIFY_AI_ADD_CANDIDATE_ACTION 2 main_loop (
       [candidate_action]
             #   this is the ID we refer when deleting this candidate action in the ai_retreat_stop event
             id=retreat_to_map_edge
             #    this is fai-specific stuff - a name of the action. just set it to same thing as id
             name=retreat_to_map_edge
             #   we use fai to parse this config block
             engine=fai
             #  this is fai-specific stuff - a type of the action. in this case,  this is a movement candidate action. all units which still can move, are considered
             type=movement
             #   Just a bit less-priority thing than combat. Use {AI_CA_GOTO_SCORE}+10  to make the retreat happen even before gotos are considered.
             #   this is "WHEN". the action is considered for execution if we return priority >0, highest-priority action is taken
             #   the intent of the formula is "if we can make a move closer to location, return good score, else return 0"
             evaluation="if(next_hop(me.loc,loc(1,me.loc.y))=null,0,if(unit_at(next_hop(me.loc,loc(1,me.loc.y)))=null, {AI_CA_COMBAT_SCORE}+10,0))"
             #   the above line is working around a bug, which'll be fixed in 1.7.12, after that the line below will work, too
             #   evaluation="if(unit_at(next_hop(me.loc,loc(1,1)))=null, {AI_CA_COMBAT_SCORE}-10 ,0)"     
             #   this is "WHAT TO DO"
             action="move(me.loc,next_hop(me.loc,loc(1,me.loc.y)))"
       [/candidate_action]
    )}
[/event]

[event]
    name=ai_retreat_stop
    #    we reference the id of the above candidate action, which is part of 'main_loop' stage of the ai.
    {MODIFY_AI_DELETE_CANDIDATE_ACTION 2 main_loop retreat_to_map_edge}
[/event]

#enddef		

#define BMR_SKIRMISH_START SKID PLAYERID FOETYPE NEXT_ MAP_WML ACTION_WML
# this establishes the start of a skirmish scenario, the player and foe sides, and the next scenario
# MAP_WML would the generator and schedules macros
# ACTION_WML would be the talking and enemy generation
# 2010-12-04: I have removed the random map generator.  It was largely undocumented and it seemed the way I was using it was no longer supported, so screw it.
###################check this########################
#[scenario]
#    name= _ "Skirmish"
#    id={SKID}
# was this a typo?    
#    map_generation=default
# HttT uses this V
#    scenario_generation=default
#    next_scenario={NEXT_}
#    victory_when_enemies_defeated=no
#[generator]
# I had tried to make it like HttT scenario, but that does not work
[scenario]
    name= _ "Skirmish"
    id={SKID}
# was this a typo?    
#    map_generation=default
    map_data="{~add-ons/Bad_Moon_Rising/maps/skirmishes/snow1.map}"
# HttT uses this V
#    scenario_generation=default
# that makes the error go away, but ruins the scenario.  need to rewrite it to use [settings]?
    next_scenario={NEXT_}
    victory_when_enemies_defeated=no
    {TURNS 22 20 18}
    [music]
	name=northerners-classic.ogg
    [/music]
    [music]
	name=battle.ogg
	append=yes
    [/music]

    {MAP_WML}

    [event]
	name=prestart
		[objectives]
		side=1
			[objective]
			condition=win
			description=_ "Defeat all enemy units"
			[/objective]
			[objective]
			condition=lose
			description=_ "Death of Heroes"
			[/objective]
			[objective]
			condition=lose
			description=_ "Time Runs Out"
			[/objective]
		[/objectives]
    [/event]

    [side]
	type=Lieutenant
	id={PLAYERID}
        side=1
        canrecruit=yes
	controller=human
        fog=no
	recruit=
	{GOLD 60 60 60}
    [/side]

    [side]
	no_leader=yes
	side=2
# 2010-12-29: making the leader just a unit, no recruiting, because of a possible bug
#	canrecruit=yes
	fog=no
	{ai/aliases/stable_singleplayer.cfg}
# I've completely commented out the [ai] block, was that causing trouble?
# I may allow them to recruit, need to think about this...
#	recruit=
#	{GOLD 200 250 300}
#	{INCOME 4 6 8}
#	ai_algorithm=formula_ai

#	[ai]

#            version=10703
#            [stage]
#                engine=fai
#                name=unit_formulas
#            [/stage]

#	aggression=0.3
#	grouping=offesnive
#	protect_leader=3.0
#	protect_leader_radius=5
#	[/ai]
	[unit]
	type={FOETYPE}
	id=Leader
	name=_ "Enemy Leader"
	x,y=10,10
	random_traits=yes
	[/unit]

     [/side]

# limiting the possible recall
# I had it set to 60 gold (3 units), but that gets too difficult when facing level 2 enemies.
# Now trying 80
# (v 1.1.2) - removing keeps -> no recruit, recall
     [event]
     name=prestart
        [store_starting_location]
            side=1
            variable=temp_starting_location
        [/store_starting_location]

        {CAPTURE_VILLAGES 1 $temp_starting_location.x $temp_starting_location.y 2}
# this is to make sure the starting position of the new map is used, not of the old map specified above
	{TELEPORT_UNIT (
		side=1
		canrecruit=yes
			) $temp_starting_location.x $temp_starting_location.y}
        {CLEAR_VARIABLE temp_starting_location}

	[store_map_dimensions]
	variable=mapsize
	[/store_map_dimensions]
	[set_variable]
	name=should_run
	value=0
	[/set_variable]
# this does not work
#	[recall]
#	    [filter]
#		variables.on_call=yes
#	    [/filter]
#	[/recall]
	[store_unit]
	    [filter]
		side=1
		x,y=recall,recall
	    [/filter]
	    variable=maybe_recall
	    kill=no
	[/store_unit]
	{FOREACH maybe_recall ri}
	    [if]
		[variable]
		name=maybe_recall[$ri].variables.on_call
		equals=yes
		[/variable]
		[then]
		[recall]
		    id=$maybe_recall[$ri].id
		[/recall]
		[/then]
	    [/if]
	{NEXT ri}
	{CLEAR_VARIABLE maybe_recall}
	[/event]

#    [event]
#        name=prestart
#
#    [/event]



     [event]
	name=die
	first_time_only=no
	[filter]
	side=2
	    [not]
	    id=Leader
	    [/not]
	[/filter]
	[if]
	    [have_unit]
	    side=2
	    [not]
	    id=Leader
	    [/not]
	    [/have_unit]
	[else]
	[store_unit]
	    [filter]
	    id={PLAYERID}
	    [/filter]
		kill=no
		variable=playpos
	[/store_unit]
	[store_unit]
	    [filter]
	    id=Leader
	    [/filter]
		kill=no
		variable=leaderpos
	[/store_unit]
	    [if]
		[variable]
		name=leaderpos.y
		less_than=$playpos.y
		[/variable]
		[then]
		[modify_side]
		side=2
		[ai]
		    [leader_goal]
			x,y=12,1
		    [/leader_goal]
		[/ai]
		[/modify_side]
		[/then]
		[else]
		[modify_side]
		side=2
		[ai]
		    [leader_goal]
			x,y=12,$mapsize.height
		    [/leader_goal]
		[/ai]
		[/modify_side]
		[/else]
	     [/if]
	{CLEAR_VARIABLE playpos}
	{CLEAR_VARIABLE leaderpos}
	[/else]
	[/if]
     [/event]

     [event]
     name=moveto
	[filter]
	    id=Leader
	    y=1,$mapsize.height
	[/filter]
	     [message]
		speaker=Leader
		message= _ "I'm out of here!"
	     [/message]
	     [kill]
		id=Leader
	     [/kill]
	     [message]
		speaker={PLAYERID}
		message= _ "That one will bring others, we don't have time to scavenge resources from the dead... At least we got some combat experience."
	     [/message]
    [store_unit]
        [filter]
            side=1
		[not]
		    x,y=recall,recall
		[/not]
        [/filter]
        variable=MODIFY_UNIT_store
        kill=yes
    [/store_unit]
# you still get experience
    [set_variable]
	name=sk_prize_exp
	value=0.07
    [/set_variable]
    [set_variable]
	name=sk_prize_exp
	multiply=$sk_prize
    [/set_variable]
# float was ruining things
    [set_variable]
	name=sk_prize_exp
	ipart=$sk_prize_exp
    [/set_variable]

# #ifdef ___UNUSED___

    {FOREACH MODIFY_UNIT_store MODIFY_UNIT_i}
        [set_variable]
            name=MODIFY_UNIT_store[$MODIFY_UNIT_i].experience
            add=$sk_prize_exp
        [/set_variable]
        [unstore_unit]
            variable=MODIFY_UNIT_store[$MODIFY_UNIT_i]
            find_vacant=no
        [/unstore_unit]
    {NEXT MODIFY_UNIT_i}
# #endif

    {CLEAR_VARIABLE MODIFY_UNIT_store}
	[message]
	    speaker=narrator
	    message = _ "$sk_prize_exp| experience gained."
	    image = wesnoth-icon.png
	[/message]
    {CLEAR_VARIABLE sk_prize_exp}
		[allow_recruit]
		side=1
		type=Ukian Runner, Ukian Archer, Ukian Regular, Ukian Dog
		[/allow_recruit]
                [endlevel]
		   {CONTINUE}
                [/endlevel]
     [/event]

     {ACTION_WML}

     {BMR_SK_VICTORY}

     {BMR_HERO_DEATHS}

[/scenario]

#enddef


#ifdef ___UNUSED___
# #define BMR_SKIRMISH_TALK ID1 ID2
# a simple way to have a randomized dialogue at the start of the skirmish
# ID1 is id of player leader, ID2 is id of player hero

    [event]
    name=prestart
	[recall]
	id={ID2}
	x,y=
	[/recall]
	[set_variable]
	name=randtalk
	rand=1..7
	[/set_variable]	
    [/event]

# I can't think of a way to not make this sound stupid, I'm removing it...

    [event]
    name=start
	[switch]
	variable=randtalk
	    [case]
	    value=1
		[message]
		speaker={ID1}
		message= _ "We should have stayed on the path..."
		[/message]
		[message]
#		speaker={ID2}
		side=1
		message= _ "You always say that."
		[/message]
	    [/case]
	    [case]
	    value=2
		[message]
		speaker={ID1}
		message= _ "This is a chance to train our forces."
		[/message]
		[message]
#		speaker={ID2}
		side=1
		message= _ "That's one way to look at it. "
		[/message]
	    [/case]
	    [case]
	    value=3
		[message]
#		speaker={ID2}
		side=1
		message= _ "We should have stayed on the path..."
		[/message]
		[message]
		speaker={ID1}
		message= _ "I'm not laughing."
		[/message]
	    [/case]
	    [case]
	    value=4
		[message]
		speaker={ID1}
		message= _ "We should have stayed on the path..."
		[/message]
		[message]
#		speaker={ID2}
		side=1
		message= _ "Indeed."
		[/message]
	    [/case]
	    [case]
	    value=5
		[message]
		speaker={ID1}
		message= _ "This is a chance to train our forces."
		[/message]
		[message]
#		speaker={ID2}
		side=1
		message= _ "Do we really have time for this?"
		[/message]
		[message]
		speaker={ID1}
		message= _ "Not really, so let's get this over with..."
		[/message]
	    [/case]
	    [else]
		[message]
		speaker={ID1}
		message= _ "We should have stayed on the path..."
		[/message]
	    [/else]		
        [/switch]
	{CLEAR_VARIABLE randtalk}
    [/event]

# #enddef 
#endif
